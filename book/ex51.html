
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from learnpythonthehardway.org/book/ex51.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 01 Aug 2012 02:03:17 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Exercise 51: Getting Input From A Browser &mdash; Learn Python The Hard Way, 2nd Edition</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Learn Python The Hard Way, 2nd Edition" href="index-2.html" />
    <link rel="next" title="Exercise 52: The Start Of Your Web Game" href="ex52.html" />
    <link rel="prev" title="Exercise 50: Your First Website" href="ex50.html" /> 
  </head>
  <body>
    <div class="related">
        <ul>
        <li class="right"><a style="color: #C40B46;" href="http://learncodethehardway.org/contact.html" title="Need Help?">Need Help?</a></li>
        <li class="right"><a style="color: #C40B46;" href="http://regex.learncodethehardway.org/" title="Learn Regex">Learn Regex</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://sql.learncodethehardway.org/" title="Learn SQL">Learn SQL</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://c.learncodethehardway.org/" title="Learn C">Learn C</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://ruby.learncodethehardway.org/" title="Learn Ruby">Learn Ruby</a> | </li>
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19967/19291?referer=http%3A//learnpythonthehardway.org/book/"><b>Buy PDF - $2.99</b></a> |
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19968/19292?referer=http%3A//learnpythonthehardway.org/book/"><b>ePub - $2.99</b></a> |
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19969/19293?referer=http%3A//learnpythonthehardway.org/book/"><b>Both - $5</b></a></li>
        </ul>
    </div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ex52.html" title="Exercise 52: The Start Of Your Web Game"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="ex50.html" title="Exercise 50: Your First Website"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Learn Python The Hard Way, 2nd Edition</a> &raquo;</li> 
        <li class="right"><a href="search.html" title="search">search</a> | </li>
      </ul>
    </div>



    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="exercise-51-getting-input-from-a-browser">
<h1>Exercise 51: Getting Input From A Browser<a class="headerlink" href="#exercise-51-getting-input-from-a-browser" title="Permalink to this headline">¶</a></h1>
<p>While it's exciting to see the browser display &quot;Hello World&quot;, it's even
more exciting to let the user submit text to your application from
a form.  In this exercise we'll improve our starter web application
using forms and storing information about the user into their &quot;session&quot;.</p>
<div class="section" id="how-the-web-works">
<h2>How The Web Works<a class="headerlink" href="#how-the-web-works" title="Permalink to this headline">¶</a></h2>
<p>Time for some boring stuff.  You need to understand a bit more about how the web
works before you can make a form.  This description isn't complete, but it's
accurate and will help you figure out what might be going wrong with your
application.  Also, creating forms will be easier if you know
what they do.</p>
<p>I'll start with a simple diagram that shows you the different parts of a web
request and how the information flows:</p>
<div class="figure align-center">
<img alt="_images/http_request_diagram.png" src="_images/http_request_diagram.png" />
</div>
<p>I've labeled the lines with letters so I can walk you through a regular request process:</p>
<ol class="arabic simple">
<li>You type in the url <tt class="docutils literal"><span class="pre">http://learnpythonthehardway.org/</span></tt> into your browser and it
sends the request out on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(A)</span></tt> to your computer's network interface.</li>
<li>Your request goes out over the internet on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(B)</span></tt> and then to the remote
computer on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(C)</span></tt> where my server accepts the request.</li>
<li>Once my computer accepts it, my web application gets it on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(D)</span></tt>, and my
Python code runs the <tt class="docutils literal"><span class="pre">index.GET</span></tt> handler.</li>
<li>The response comes out of my Python server when I <tt class="docutils literal"><span class="pre">return</span></tt> it, and goes back
to your browser over <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(D)</span></tt> again.</li>
<li>The server running this site takes the response off <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(D)</span></tt> then sends it back
over the internet on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(C)</span></tt>.</li>
<li>The response from the server then comes off the internet on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(B)</span></tt>, and your
computer's network interface hands it to your browser on <tt class="docutils literal"><span class="pre">line</span> <span class="pre">(A)</span></tt>.</li>
<li>Finally, your browser then displays the response.</li>
</ol>
<p>In this description there are a few terms you should know so that you have a common
vocabulary to work with when talking about your web application:</p>
<dl class="docutils">
<dt>Browser</dt>
<dd>The software that you're probably using every day.  Most people don't
know what it really does, they just call it &quot;the internet&quot;.  Its job is to
take addresses (like <a class="reference external" href="../index.html">http://learnpythonthehardway.org</a>) you type into the URL
bar, then use that information to make requests to the server at
that address.</dd>
<dt>Address</dt>
<dd>This is normally a URL (Uniform Resource Locator) like <a class="reference external" href="../index.html">http://learnpythonthehardway.org/</a>
and indicates where a browser should go.  The first part <tt class="docutils literal"><span class="pre">http</span></tt> indicates
the protocol you want to use, in this case &quot;Hyper-Text Transport Protocol&quot;.  You can
also try <a class="reference external" href="ftp://ibiblio.org/">ftp://ibiblio.org/</a> to see how &quot;File Transport Protocol&quot; works.  The <tt class="docutils literal"><span class="pre">learnpythonthehardway.org</span></tt>
part is the &quot;hostname&quot;, or a human readable address you can remember and which maps
to a number called an IP address, similar to a telephone number for a computer on the
Internet.  Finally, URLs can have a trailing <tt class="docutils literal"><span class="pre">path</span></tt> like the <tt class="docutils literal"><span class="pre">/book/</span></tt> part of
<a class="reference external" href="index.html">http://learnpythonthehardway.org/book/</a> which indicates a file or some resource
<em>on</em> the server to retrieve with a request.  There are many other parts, but those are
the main ones.</dd>
<dt>Connection</dt>
<dd>Once a browser knows what protocol you want to use (http), what server you want to
talk to (learnpythonthehardway.org), and what resource on that server to get, it
must make a connection.  The browser simply asks your Operating System (OS) to open
a &quot;port&quot; to the computer, usually port 80. When it works the OS hands
back to your program something that works like a file, but is actually sending
and receiving bytes over the network wires between your computer and the
other computer at &quot;learnpythonthehardway.org&quot;.  This is also the same thing
that happens with <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> but in this case you're telling
the browser to connect to your own computer (localhost) and use port 8080
rather than the default of 80.  You could also do <a class="reference external" href="../index.html">http://learnpythonthehardway.org:80/</a>
and get the same result, except you're explicitly saying to use port 80 instead of
letting it be that by default.</dd>
<dt>Request</dt>
<dd>Your browser is connected using the address you gave. Now it needs to
ask for the resource it wants (or you want) on the remote server.  If you
gave <tt class="docutils literal"><span class="pre">/book/</span></tt> at the end of the URL, then you want the file (resource)
at /book/, and most servers will use the real file /book/index.html but
pretend it doesn't exist.  What the browser does to get this resource is
send a <em>request</em> to the server.  I won't
get into exactly how it does this, but just understand that it has to
send something to query the server for the request.  The interesting thing is that
these &quot;resources&quot; don't have to be files. For instance, when the browser in your
application asks for something, the server is
returning something your Python code generated.</dd>
<dt>Server</dt>
<dd>The server is the computer at the end of a browser's
connection that knows how to answer your browser's requests for files/resources.
Most web servers just send files, and that's actually the majority of traffic.
But you're actually building a server in Python that knows how to take
requests for resources, and then return strings that you craft using Python.
When you do this crafting, <em>you</em> are pretending to be a file to the browser,
but really it's just code.  As you can see from Ex. 50, it also doesn't
take much code to create a response.</dd>
<dt>Response</dt>
<dd>This is the HTML (css, javascript, or images) your server wants to
send back to the browser as the answer to the browser's request.  In the case
of files, it just reads them off the disk and sends them to the browser, but
it wraps the contents of the disk in a special &quot;header&quot; so the browser knows
what it's getting.  In the case of your application, you're still sending
the same thing, including the header, but you generate that data on the fly
with your Python code.</dd>
</dl>
<p>That is the fastest crash course in how a web browser accesses information on servers
on the internet.  It should work well enough for you to understand this exercise, but if not, read about it as much as you can until you get
it.  A really good way to do that is to take the diagram, and break different parts
of the web application you did in Exercise 50.  If you can break your web application
in predictable ways using the diagram, you'll start to understand how it works.</p>
</div>
<div class="section" id="how-forms-work">
<h2>How Forms Work<a class="headerlink" href="#how-forms-work" title="Permalink to this headline">¶</a></h2>
<p>The best way to play with forms is to write some code that accepts
form data, and then see what you can do.  Take your <tt class="docutils literal"><span class="pre">bin/app.py</span></tt>
file and make it look like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">web</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">(</span>
  <span class="s">&#39;/hello&#39;</span><span class="p">,</span> <span class="s">&#39;Index&#39;</span>
<span class="p">)</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">application</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>

<span class="n">render</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;templates/&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Nobody&quot;</span><span class="p">)</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;Hello, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Restart it (hit CTRL-c and then run it again) to make sure it loads
again, then with your browser go to <tt class="docutils literal"><span class="pre">http://localhost:8080/hello</span></tt>
which should display, &quot;I just wanted to say Hello, Nobody.&quot;  Next, change
the URL in your browser to <tt class="docutils literal"><span class="pre">http://localhost:8080/hello?name=Frank</span></tt> and
you'll see it say &quot;Hello, Frank.&quot;  Finally, change the <tt class="docutils literal"><span class="pre">name=Frank</span></tt> part
to be your name.  Now it's saying hello to you.</p>
<p>Let's break down the changes I made to your script.</p>
<ol class="arabic simple">
<li>Instead of just a string for <tt class="docutils literal"><span class="pre">greeting</span></tt> I'm now using <tt class="docutils literal"><span class="pre">web.input</span></tt> to
get data from the browser.  This function takes a key=value set of defaults,
parses the <tt class="docutils literal"><span class="pre">?name=Frank</span></tt> part of the URL you give it, and then returns
a nice object for you to work with that represents those values.</li>
<li>I then construct the <tt class="docutils literal"><span class="pre">greeting</span></tt> from the new <tt class="docutils literal"><span class="pre">form.name</span></tt> attribute of
the <tt class="docutils literal"><span class="pre">form</span></tt> object, which should be very familiar to you by now.</li>
<li>Everything else about the file is the same as before.</li>
</ol>
<p>You're also not restricted to just one parameter on the URL.  Change this
example to give two variables like this:
<tt class="docutils literal"><span class="pre">http://localhost:8080/hello?name=Frank&amp;greet=Hola</span></tt>.  Then change the code to
get <tt class="docutils literal"><span class="pre">form.name</span></tt> and <tt class="docutils literal"><span class="pre">form.greet</span></tt> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">greet</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>After that, try the URL. Next, leave out the <tt class="docutils literal"><span class="pre">&amp;greet=Hola</span></tt>
part so that you can see the error you get.  Since <tt class="docutils literal"><span class="pre">greet</span></tt> doesn't have
a default value in <tt class="docutils literal"><span class="pre">web.input(name=&quot;Nobody&quot;)</span></tt> then it is a required field.
Now go back and make it have a default in the <tt class="docutils literal"><span class="pre">web.input</span></tt> call to see
how you fix this.  Another thing you can do is set its default to <tt class="docutils literal"><span class="pre">greet=None</span></tt>
so that you can check if it exists and then give a better error message, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Nobody&quot;</span><span class="p">,</span> <span class="n">greet</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">greet</span><span class="p">:</span>
    <span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">greet</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">&quot;ERROR: greet is required.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-html-forms">
<h2>Creating HTML Forms<a class="headerlink" href="#creating-html-forms" title="Permalink to this headline">¶</a></h2>
<p>Passing the parameters on the URL works, but it's kind of ugly and
not easy to use for regular people.  What you really want is a &quot;POST form&quot;, which is a special HTML file that has a <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt>
tag in it.  This form will collect information from the user, then
send it to your web application just like you did above.</p>
<p>Let's make a quick one so you can see how it works.  Here's the new HTML
file you need to create, in <tt class="docutils literal"><span class="pre">templates/hello_form.html</span></tt>:</p>
<div class="highlight-python"><pre>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Sample Web Form&lt;/title&gt;
    &lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;Fill Out This Form&lt;/h1&gt;

&lt;form action="/hello" method="POST"&gt;
    A Greeting: &lt;input type="text" name="greet"&gt;
    &lt;br/&gt;
    Your Name: &lt;input type="text" name="name"&gt;
    &lt;br/&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<p>You should then change <tt class="docutils literal"><span class="pre">bin/app.py</span></tt> to look like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">web</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">(</span>
  <span class="s">&#39;/hello&#39;</span><span class="p">,</span> <span class="s">&#39;Index&#39;</span>
<span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">application</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>

<span class="n">render</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;templates/&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">hello_form</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Nobody&quot;</span><span class="p">,</span> <span class="n">greet</span><span class="o">=</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">greet</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeting</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Once you've got those written up, simply restart the web application
again and hit it with your browser like before.</p>
<p>This time you'll get a form asking you for &quot;A Greeting&quot; and &quot;Your Name&quot;.
When you hit the <tt class="docutils literal"><span class="pre">Submit</span></tt> button on the form, it will give you the
same greeting you normally get, but this time look at the URL in your
browser.  See how it's <tt class="docutils literal"><span class="pre">http://localhost:8080/hello</span></tt> even though
you sent in parameters.</p>
<p>The part of the <tt class="docutils literal"><span class="pre">hello_form.html</span></tt> file that makes this work is the
line with <tt class="docutils literal"><span class="pre">&lt;form</span> <span class="pre">action=&quot;/hello&quot;</span> <span class="pre">method=&quot;POST&quot;&gt;</span></tt>.  This tells your
browser to:</p>
<ol class="arabic simple">
<li>Collect data from the user using the form fields inside the form.</li>
<li>Send them to the server using a <tt class="docutils literal"><span class="pre">POST</span></tt> type of request, which is
just another browser request that &quot;hides&quot; the form fields.</li>
<li>Send that to the <tt class="docutils literal"><span class="pre">/hello</span></tt> URL (as shown in the <tt class="docutils literal"><span class="pre">action=&quot;/hello&quot;</span></tt> part).</li>
</ol>
<p>You can then see how the two <tt class="docutils literal"><span class="pre">&lt;input&gt;</span></tt> tags match the names of the variables
in your new code.  Also notice that instead
of just a <tt class="docutils literal"><span class="pre">GET</span></tt> method inside <tt class="docutils literal"><span class="pre">class</span> <span class="pre">index</span></tt>, I have another method <tt class="docutils literal"><span class="pre">POST</span></tt>.</p>
<p>How this new application works is:</p>
<ol class="arabic simple">
<li>The browser first hits the web application at <tt class="docutils literal"><span class="pre">/hello</span></tt> but it sends a
<tt class="docutils literal"><span class="pre">GET</span></tt>, so our <tt class="docutils literal"><span class="pre">index.GET</span></tt> function runs and returns the <tt class="docutils literal"><span class="pre">hello_form</span></tt>.</li>
<li>You fill out the form in the browser, and the browser does what the <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt>
says and sends the data as a <tt class="docutils literal"><span class="pre">POST</span></tt>.</li>
<li>The web application then runs the <tt class="docutils literal"><span class="pre">index.POST</span></tt> method rather than the
<tt class="docutils literal"><span class="pre">index.GET</span></tt> method to handle this request.</li>
<li>This <tt class="docutils literal"><span class="pre">index.POST</span></tt> method then does what it normally does to send
back the hello page like before.  There's really nothing new in
here, it's just moved into a new function.</li>
</ol>
<p>As an exercise, go into the <tt class="docutils literal"><span class="pre">templates/index.html</span></tt> file and add a
link <em>back</em> to just <tt class="docutils literal"><span class="pre">/hello</span></tt> so that you can keep filling out the form
and seeing the results.  Make sure you can explain how this link
works and how it's letting you cycle between <tt class="docutils literal"><span class="pre">templates/index.html</span></tt> and
<tt class="docutils literal"><span class="pre">templates/hello_form.html</span></tt> and what's being run inside this latest
Python code.</p>
</div>
<div class="section" id="creating-a-layout-template">
<h2>Creating A Layout Template<a class="headerlink" href="#creating-a-layout-template" title="Permalink to this headline">¶</a></h2>
<p>When you work on your game in the next Exercise, you'll need to make a
bunch of little HTML pages.  Writing a full web page each time will quickly become tedious. Luckily you can create a &quot;layout&quot; template, or a kind of shell that will wrap all your other pages
with common headers and footers.  Good programmers
try to reduce repetition, so layouts are essential for being a good programmer.</p>
<p>Change <tt class="docutils literal"><span class="pre">templates/index.html</span></tt> to be like this:</p>
<div class="highlight-python"><pre>$def with (greeting)

$if greeting:
    I just wanted to say &lt;em style="color: green; font-size: 2em;"&gt;$greeting&lt;/em&gt;.
$else:
    &lt;em&gt;Hello&lt;/em&gt;, world!

</pre>
</div>
<p>Then change <tt class="docutils literal"><span class="pre">templates/hello_form.html</span></tt> to be like this:</p>
<div class="highlight-python"><pre>&lt;h1&gt;Fill Out This Form&lt;/h1&gt;

&lt;form action="/hello" method="POST"&gt;
    A Greeting: &lt;input type="text" name="greet"&gt;
    &lt;br/&gt;
    Your Name: &lt;input type="text" name="name"&gt;
    &lt;br/&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;

</pre>
</div>
<p>All we're doing is stripping out the &quot;boilerplate&quot; at the top and the
bottom which is always on every page.  We'll put that back into a
single <tt class="docutils literal"><span class="pre">templates/layout.html</span></tt> file that handles it for us from
now on.</p>
<p>Once you have those changes, create a <tt class="docutils literal"><span class="pre">templates/layout.html</span></tt> file
with this in it:</p>
<div class="highlight-python"><pre>$def with (content)

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Gothons From Planet Percal #25&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

$:content

&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
<p>This file looks like a regular template, except that it's going to be
passed the <em>contents</em> of the other templates and used to <em>wrap</em> them.
Anything you put in here doesn't need to be in the other templates.
You should also pay attention to how <tt class="docutils literal"><span class="pre">$:content</span></tt> is written, since
it's a little different from the other template variables.</p>
<p>The <em>final</em> step is to change the line that makes the <tt class="docutils literal"><span class="pre">render</span></tt> object to
be this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">render</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;templates/&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which tells <tt class="docutils literal"><span class="pre">lpthw.web</span></tt> to use the <tt class="docutils literal"><span class="pre">templates/layout.html</span></tt> file as the
<em>base</em> template for all the other templates.  Restart your application and
then try to change the layout in interesting ways, but without changing the
other templates.</p>
</div>
<div class="section" id="writing-automated-tests-for-forms">
<h2>Writing Automated Tests For Forms<a class="headerlink" href="#writing-automated-tests-for-forms" title="Permalink to this headline">¶</a></h2>
<p>It's easy to test a web application with your browser by just hitting refresh,
but come on, we're programmers here.  Why do some repetitive task when we can write some code to test our application?  What you're going to do next is
write a little test for your web application form based on what
you learned in Exercise 47.  If you don't remember Exercise 47, read it again.</p>
<p>You need to do a bit of setup to make Python let you load your <tt class="docutils literal"><span class="pre">bin/app.py</span></tt>
file for testing.  When we get to Exercise 52 you'll change this, but for now
create an empty <tt class="docutils literal"><span class="pre">bin/__init__.py</span></tt> file so Python thinks <tt class="docutils literal"><span class="pre">bin/</span></tt> is a directory.</p>
<p>I've also created a simple little function for <tt class="docutils literal"><span class="pre">lpthw.web</span></tt> that lets you
assert things about your web application's response, aptly named <tt class="docutils literal"><span class="pre">assert_response</span></tt>.
Create the file <tt class="docutils literal"><span class="pre">tests/tools.py</span></tt> with these contents:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">&quot;200&quot;</span><span class="p">):</span>

    <span class="k">assert</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s">&quot;Expected response </span><span class="si">%r</span><span class="s"> not in </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s">&quot;200&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Response data is empty.&quot;</span>

    <span class="k">if</span> <span class="n">contains</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">contains</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;Response does not contain </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">contains</span>

    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">reg</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s">&quot;Response does not match </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">matches</span>

    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Once that's in place you can write your automated test for the last version of the
<tt class="docutils literal"><span class="pre">bin/app.py</span></tt> file you created.  Create a new file named <tt class="docutils literal"><span class="pre">tests/app_tests.py</span></tt>
with this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">bin.app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">tests.tools</span> <span class="kn">import</span> <span class="n">assert_response</span>

<span class="k">def</span> <span class="nf">test_index</span><span class="p">():</span>
    <span class="c"># check that we get a 404 on the / URL</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">&quot;404&quot;</span><span class="p">)</span>

    <span class="c"># test our first GET request to /hello</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
    <span class="n">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

    <span class="c"># make sure default values work for the form</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
    <span class="n">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="s">&quot;Nobody&quot;</span><span class="p">)</span>

    <span class="c"># test that we get expected values</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Zed&#39;</span><span class="p">,</span> <span class="s">&#39;greet&#39;</span><span class="p">:</span> <span class="s">&#39;Hola&#39;</span><span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="s">&quot;Zed&quot;</span><span class="p">)</span>
    
</pre></div>
</td></tr></table></div>
<p>Finally, use nosetests to run this test setup and test your web application:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> nosetests
<span class="go">.</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 1 test in 0.059s</span>

<span class="go">OK</span>
</pre></div>
</div>
<p>What I'm doing here is I'm actually <em>importing</em> the whole application from the
<tt class="docutils literal"><span class="pre">bin/app.py</span></tt> module, then running it manually.  The <tt class="docutils literal"><span class="pre">lpthw.web</span></tt> framework
has a very simple API for processing requests, which looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">localpart</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;0.0.0.0:8080&#39;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">https</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This means you can pass in the URL as the first parameter, then change the
method of the request, as wellas what form data you send, including the host and headers.
This works without running an actual web server so you can do tests with automated tests
and also use your browser to test a running server.</p>
<p>To validate responses from this function, use the <tt class="docutils literal"><span class="pre">assert_response</span></tt> function
from <tt class="docutils literal"><span class="pre">tests.tools</span></tt> which has:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">assert_response</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">&quot;200&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pass in the response you get from calling <tt class="docutils literal"><span class="pre">app.request</span></tt> then
add things you want checked.  Use the <tt class="docutils literal"><span class="pre">contains</span></tt> parameter to make
sure that the response contains certain values.  Use the <tt class="docutils literal"><span class="pre">status</span></tt>
parameter to check for certain responses.  There's actually quite a lot of
information in this little function so it would be good for you to
study it.</p>
<p>In the <tt class="docutils literal"><span class="pre">tests/app_tests.py</span></tt> automated test I'm first making sure the <tt class="docutils literal"><span class="pre">/</span></tt> URL
returns a &quot;404 Not Found&quot; response, since it actually doesn't exist.  Then I'm
checking that <tt class="docutils literal"><span class="pre">/hello</span></tt> works with both a <tt class="docutils literal"><span class="pre">GET</span></tt> and <tt class="docutils literal"><span class="pre">POST</span></tt> form.  Following
the test should be fairly simple, even if you might not totally know what's going on.</p>
<p>Take some time studying this latest application, especially how the automated testing works.  Make sure you understand how I
imported the application from <tt class="docutils literal"><span class="pre">bin/app.py</span></tt> and ran it directly for the automated
test.  This is an important trick that will lead to
more learning.</p>
</div>
<div class="section" id="extra-credit">
<h2>Extra Credit<a class="headerlink" href="#extra-credit" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Read even more about HTML, and give the simple form a better layout.
It helps to draw what you want to do on paper and <em>then</em>
implement it with HTML.</li>
<li>This one is hard, but try to figure out how you'd do a file upload form so that you can
upload an image and save it to the disk.</li>
<li>This is even more mind-numbing, but go find the HTTP RFC (which is the document that
describes how HTTP works) and read as much of it as you can.  It is really boring,
but comes in handy once in a while.</li>
<li>This will also be really difficult, but see if you can find someone to help you setup
a web server like Apache, Nginx, or thttpd.  Try to serve a couple of your .html
and .css files with it just to see if you can.  Don't worry if you can't, web servers
kind of suck.</li>
<li>Take a break after this and just try making as many different web applications as
you can.  You should <em>definitely</em> read about sessions in <tt class="docutils literal"><span class="pre">web.py</span></tt> (which is
the same as <tt class="docutils literal"><span class="pre">lpthw.web</span></tt>) so you can understand how to keep state for a user.</li>
</ol>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
        <ul>
        <li class="right"><a style="color: #C40B46;" href="http://learncodethehardway.org/contact.html" title="Need Help?">Need Help?</a></li>
        <li class="right"><a style="color: #C40B46;" href="http://regex.learncodethehardway.org/" title="Learn Regex">Learn Regex</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://sql.learncodethehardway.org/" title="Learn SQL">Learn SQL</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://c.learncodethehardway.org/" title="Learn C">Learn C</a> | </li>
        <li class="right"><a style="color: #C40B46;" href="http://ruby.learncodethehardway.org/" title="Learn Ruby">Learn Ruby</a> | </li>
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19967/19291?referer=http%3A//learnpythonthehardway.org/book/"><b>Buy PDF - $2.99</b></a> |
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19968/19292?referer=http%3A//learnpythonthehardway.org/book/"><b>ePub - $2.99</b></a> |
        <li><a style="color: #C40B46;" href="https://getdpd.com/v2/cart/add/8273/19969/19293?referer=http%3A//learnpythonthehardway.org/book/"><b>Both - $5</b></a></li>
        </ul>
    </div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ex52.html" title="Exercise 52: The Start Of Your Web Game"
             >next</a></li>
        <li class="right" >
          <a href="ex50.html" title="Exercise 50: Your First Website"
             >previous</a> |</li>
        <li><a href="../index.html">Learn Python The Hard Way, 2nd Edition</a> &raquo;</li> 
        <li class="right"><a href="search.html" title="search">search</a> | </li>
      </ul>
    </div>
    <a name="comments"><hr/></a>
<div sytle="text-align: left">
    <div style="background: white; padding: 10px" id="disqus_thread"></div>
</div>
    <script type="text/javascript">
        var dow = new Date().getDay();

        if(dow == 5 || dow == 6) {
            $("#disqus_thread").html("<h1>Today Is Zed's Day Off</h1><p>I take Friday and Saturday off.  Comments open again on Sunday-Thursday.</p>")
        } else {
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'learn-code-the-hard-way'; // required: replace example with your forum shortname


            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        }
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div class="footer">
      &copy; Copyright 2010, Zed A. Shaw.
      Last updated on Jul 26, 2012.
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24168052-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




  </body>

<!-- Mirrored from learnpythonthehardway.org/book/ex51.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 01 Aug 2012 02:03:17 GMT -->
</html>